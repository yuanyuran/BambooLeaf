<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    
	<script src="../javascripts/jquery-2.1.4.min.js" type="text/javascript"></script>
	<script src="../javascripts/jquery.cookie.js" type="text/javascript"></script>
	<link  rel="stylesheet" href="../css/page_style.css" type="text/css" />
	<script type="text/javascript" src="../javascripts/jquery-ui-1.11.4/jquery-ui.js"></script>
    <script type="text/javascript" src="../javascripts/my_local.js"></script>
    <link rel="stylesheet" type="text/css" href="../javascripts/jquery-ui-1.11.4/jquery-ui.css"/>
    <style type="text/css">
		th td {margin:10px}
	</style>
   </head>
  
   <body>
		<div style="height=60px">
			<span id="title">当前位置》课程安排》课程表</span>
		</div>
		<hr/>        
		<div style="float:left;">
			<button  class="margin_left" id="checkbyweek">按周查看</button><br/><br/>
			<button  class="margin_left" id="checkbyday">按天查看</button><br/><br/>
			<button  class="margin_left" id="export_table">导出课表</button><br/><br/>
		</div>
        
        <div>
        	<div style="float:left;margin-left:400px;" id="datepicker"></div><br/>
		</div>
        <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> <br/> 
         <hr/>
        <div id="week_title_div">
		<span id="year_number"></span>
		<span>年</span>&nbsp;
		<span>第</span>
		<span id="week_number">20</span>
		<span>周</span>
		<button class="margin_left" id="add_newclass_week">新增课程</button>
		<button class="margin_left" id="clone_class_week">复制课表</button>
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<a href="javascript:void(0);" onclick="pre_week()">[上一周]</a>&nbsp;&nbsp;
		<a href="javascript:void(0);" onclick="next_week()">[下一周]</a>&nbsp;&nbsp;
		<span >跳至</span>
		<span id="year_number_text"></span>
		<span >年&nbsp;第</span>
		<input id="week_target" style="width:20px"></input>
		<span >周</span>
		<button class="margin_left" id="jump">跳转</button><br/>
		<span id="week_this" style='color:#FF0000'>(本周课表)</span>
		</div>
		
		<div id="day_title_div" style="display:none">
		<span id="date_text">2015/06/17</span>&nbsp;&nbsp;
		<span id="day_in_week">星期三</span>
		<span id="today" style='color:#FF0000'>(今日)</span>
		<button class="margin_left" id="add_newclass_day">新增课程</button>
		<button class="margin_left" id="clone_class_day">复制课表</button>
		</div>
        
		<div id="add_newclass_div" style="display:none" >
			<br/>
			<table id="add_newclass_table" border="1" cellspacing="0" cellpadding="10" > <!--width="1200"-->
			<tr>
			<th align="left">开始日期</th>
			<th align="left">截止日期</th>
			<th align="left">时间</th>
			<th align="left">科目</th>
			<th align="left">形式</th>
			<th align="left">学生</th>
			<th align="left">老师</th>
			<th align="left">年级</th>
			<th align="left">教室</th>
			<th align="left">星期几</th>
			<th align="left">功能</th>
			</tr>
			<tr>
            <td>周一<br/>2015/06/15</td>
			<td>周日<br/>2015/06/21</td>
			<td>
            <select  class="time_sel" >  
                <option value="1">8:00~10:30</option>  
                <option value="2">10:30~12:00</option>  
                <option value="3">13:30~15:00</option> 
            </select> 
            </td>
			<td>
            <select  class="subject_sel" >  
                <option value="1">语文</option>  
                <option value="2">数学</option>  
                <option value="3">英语</option> 
            </select> 
            </td>
			<td>
            <select  class="type_sel" >  
                <option value="1">一对一</option>  
                <option value="2">小班</option>  
            </select> 
            </td>
			<td>
            <select  class="student_sel" >  
                <option value="1">张三</option>  
                <option value="2">李四</option>  
            </select> 
            </td>
			<td>
             <select  class="teacher_sel" >  
                <option value="1">张老师</option>  
                <option value="2">李老师</option>  
            </select>
            </td>
			<td>
            <select  class="grade_sel" >  
                <option value="1">初一</option>  
                <option value="2">高一</option>  
            </select>
            </td>
			<td>
            <select  class="classroom_sel" >  
				<option value="0">随机</option> 
                <option value="1">教室一</option>  
                <option value="2">教室二</option>  
            </select>
            </td>
			<td>
            <div  class="daynum_sel" >  
				<input type="checkbox" value="1"/>周一</input> 
                <input type="checkbox" value="2"/>周二</input>  
				<input type="checkbox" value="3"/>周三</input><br/>
				<input type="checkbox" value="4"/>周四</input> 
				<input type="checkbox" value="5"/>周五</input> 
				<input type="checkbox" value="6"/>周六</input><br/>
				<input type="checkbox" value="7"/>周日</input> 
            </div>
            </td>
			<td>
			<button class="save_newclass">保存</button>&nbsp;&nbsp;<button onclick="$('#add_newclass_div').hide()">放弃</button>
			</td>
			</tr>
		</table>
		</div>
		<hr/>
		<table id="week_table" border="1" cellspacing="0" cellpadding="5" > <!--width="1200"-->
			<tr>
			<th align="left">时间</th>
			<th align="left"></th>
			<th align="left"></th>
			<th align="left"></th>
			<th align="left"></th>
			<th align="left"></th>
			<th align="left"></th>
			<th align="left"></th>
			</tr>
			
			
			<tr>
            <td>8:30~10:00</td>
			<td>
            <a href="javascript:void(0);">王同学、李老师</a><br/>
			<a href="javascript:void(0);">李同学、宋老师</a><br/>
			<a href="javascript:void(0);">洪同学、秦老师</a><br/>
            </td>
			<td>
            
            </td>
			<td>
            
            </td>
			<td>
            
            </td>
			<td>
             
            </td>
			<td>
            
            </td>
			<td>
            
            </td>
			</tr>
		</table>
		
		<table id="day_table" border="1" cellspacing="0" cellpadding="5" style="display:none"> <!--width="1200"-->
			<tr>
			<th align="left">时间</th>
			<th align="left">科目</th>
			<th align="left">教师</th>
			<th align="left">形式</th>
			<th align="left">学生</th>
			<th align="left">年级</th>
			<th align="left">教室</th>
			<th align="left">备注</th>
			<th align="left">功能</th>
			</tr>
			
			
			<tr>
            <td>8:30~10:00</td>
			<td>物理</td>
			<td>洪老师</td>
			<td>一对一</td>
			<td>李红利</td>
			<td>初三</td>
			<td>02</td>
			<td/>
			<td>
				<button class="edit">编辑</button>
				<button class="delete">删除</button>
			</td>
			</tr>
		</table>
		<div style="display:none" id="dialog" title="课表克隆">
			<p>按周克隆</p>
				<span style="margin-right:10px;">将</span>
				 <select style="margin-right:10px;" id="clone_source_year" >  
					<option val="2015">2015</option> 
					<option val="2016">2016</option>  
					<option val="2017">2017</option>  
					<option val="2018">2018</option>  
					<option val="2019">2019</option>  
					<option val="2020">2020</option> 
					<option val="2021">2021</option>  
				</select> 
				<select style="margin-right:10px;" id="clone_source_week"></select> 
				
				<select style="margin-right:10px;float:right" id="clone_target_week"></select> 
				<select style="margin-right:10px;float:right" id="clone_target_year">
					<option val="2015">2015</option> 
					<option val="2016">2016</option>  
					<option val="2017">2017</option>  
					<option val="2018">2018</option>  
					<option val="2019">2019</option>  
					<option val="2020">2020</option> 
					<option val="2021">2021</option> 
				</select> 
				<span>课程</span><span style="margin-right:10px;float:right">复制到</span>
				 <br/><br/>
				
				<button style="float:right;margin-right:10px" id="clone_week">按周克隆</button>
			<br/><br/>
			<hr/>
			<p>按天克隆</p>
			<span style="font-size:15px">(先选中左侧日历中的日期，再选则右侧课表中的日期，点击“按天克隆”按钮，进行复制)</span><br/>
			<br/>
			<div style="float:left" id="datepicker_source"></div>
 			<div style="float:right;margin-right:10px" id="datepicker_target"></div>
			<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
			
				<span style="margin-right:10px;">将</span>
				<input style="margin-right:10px;" disabled="disabled" id="day_source"></input>
				<span style="margin-right:10px;">课程</span>
				<input style="margin-right:10px;float:right" disabled="disabled" id="day_target"></input>
				<span style="margin-right:10px;float:right">复制到</span>
			<br/><br/>
			
			<button style="float:right;margin-right:10px" id="clone_day">按天克隆</button>
			
		</div>
   </body>
   <script>
	

		var week = 0;
		var weekstrlist = new Array();
		 weekstrlist[0] = "星期一";
		 weekstrlist[1] = "星期二";
		 weekstrlist[2] = "星期三";
		 weekstrlist[3] = "星期四";
		 weekstrlist[4] = "星期五";
		 weekstrlist[5] = "星期六";
		 weekstrlist[6] = "星期日";
		var cur_Date;
		$(function(){
			var myDate = new Date();
			cur_Date = myDate;
			var day = myDate.getDay();
			if(day == 0) day=7;
			fresh_table(cur_Date, day, 0, $("#week_table tr"));
			var week_num = $.datepicker.iso8601Week(myDate);
			var year = cur_Date.getFullYear()
			$("#year_number").text(year);
			$("#year_number_text").text(year);
			$("#week_number").text(week_num);
			$("#week_this").show();
			//var d = new Date("2008/2/27");
			//取得当前月份d.getMonth()+1   getMonth是0-11,所以要加1
			//d.setMonth(d.getMonth() + 6); //加六个月
			//d.setFullYear(d.getFullYear() + 1);  //加一年
			//d.setDate(d.getDate() + 2); //加一天
			//拼起来
			//alert(d);
		});
		
		$("#add_newclass_week").click(function(){
			$("#add_newclass_div").show();
		});	
		
		$("#add_newclass_day").click(function(){
			$("#add_newclass_div").show();
		});	
		
		$("#checkbyweek").click(function(){
			week_div_show();
			//var myDate = new Date();
			var day = cur_Date.getDay();
			if(day == 0) day=7;
			fresh_table(cur_Date, day, 0, $("#week_table tr"));
			var week_num = $.datepicker.iso8601Week(cur_Date);
			$("#week_number").text(week_num);
			$("#week_this").show();
		});
		
		$("#checkbyday").click(function(){
			day_div_show();
			var myDate = new Date();
			var month = myDate.getMonth()+1;
			if(month < 10) {
				month = "0" + month;
			}
			var today_str = (myDate.getFullYear()+"/" + month +"/" + myDate.getDate());
			show_day_table(today_str);
		});
		
		function week_div_show() {
			$("#week_div").show();
			$("#week_table").show();
			$("#week_title_div").show();
			$("#day_div").hide();
			$("#day_table").hide();
			$("#day_title_div").hide();
		};
		
		function day_div_show() {
			$("#week_div").hide();
			$("#week_table").hide();
			$("#week_title_div").hide();
			$("#day_div").show();
			$("#day_table").show();
			$("#day_title_div").show();
		};
		
		$("#datepicker").datepicker({
			showOtherMonths: true,
			selectOtherMonths: false,
			changeMonth: true,
			changeYear: true,
			//showWeek: true,
			dateFormat: 'yy/mm/dd',
			onSelect: function(dateText,inst){
				show_day_table(dateText);
			}
		});
		
		function show_day_table(dateText) {
			var myDate = new Date();
			var month = myDate.getMonth()+1;
			if(month < 10) {
				month = "0" + month;
			}
			var today_str = (myDate.getFullYear()+"/" + month +"/" + myDate.getDate());
			day_div_show();
			$("#date_text").text(dateText);
			var selectedDate = new Date(dateText);
			var day = selectedDate.getDay();
			if(day == 0) day=7;
			$("#day_in_week").text(weekstrlist[day-1]);
			
			if(dateText == today_str){
				$("#today").show();
			} else {
				$("#today").hide();
			}
			
		};
		
		$("#week_target").bind("keypress",function(event){
            if(event.keyCode == "13")    
            {
                var week_num = $("#week_target").val();
				jump_to_week(week_num);
            }
        });
		
		
		
		$("#jump").click(function(){
			var week_num = $("#week_target").val();
			jump_to_week(week_num);
		});
		
		function showdialog() {
			var dialogOpts = {
				bgiframe: true,
				resizable: false,
				height:700,
				width:800,
				modal: true
			}
			$("#dialog").dialog(dialogOpts);
			var myDate = new Date();
			var year = myDate.getFullYear();
			$("#clone_source_year").val(year); 
			$("#clone_target_year").val(year); 
			refresh_select(year, $("#clone_source_week"));
			refresh_select(year, $("#clone_target_week"));
		};
		
		$("#clone_class_week").click(function(){
			showdialog();
		});
		
		$("#clone_class_day").click(function(){
			showdialog();
		});
		
		
		
		
		
		function jump_to_week(week_num) {
			var ex = /^\d+$/;
			if(week_num != "") {
				if(isNaN(week_num) == false && ex.test(week_num)){
					if($("#year_number").text() != $("#year_number_text").text())
					{
						var myDate = new Date();
						cur_Date = myDate;
						week=0;
					}
					//var myDate = new Date();
					var day = cur_Date.getDay();
					if(day == 0) day=7;
					var week_now = $.datepicker.iso8601Week(cur_Date);
					//alert("week_now is " + week_now);
					var week_tmp = week;
					//alert("lin 342: week is " + week);
					week += week_num - week_now;
					//alert("line 344 :week is " + week);
					cur_Date.setDate(cur_Date.getDate()+7*(week_num - week_now)); 
					var week_jump = $.datepicker.iso8601Week(cur_Date);
					//alert("week_jump is " + week_jump);
					//alert("week_num is " + week_num);
					if(week_jump == week_num) {
						//alert("cur_Date is " + cur_Date);
						fresh_table(cur_Date, day, week, $("#week_table tr"));
					}else{
						cur_Date.setDate(cur_Date.getDate()-7*week); 
						week = week_tmp;
						alert("lin 353: week is " + week);
						return false;
					}
					$("#week_number").text(week_num);
					$("#year_number").text("2015")
					if(week == 0) {
						$("#week_this").show();
					} else {
						$("#week_this").hide();
					}
				}
			} 
		};
		
		function pre_week() {
			$("#week_target").val("");
			//var myDate = new Date();
			cur_Date.setDate(cur_Date.getDate() - 7); 
			var day = cur_Date.getDay();
			week--;
			if(day == 0) day=7;
			//alert($.datepicker.iso8601Week(myDate));
			fresh_table(cur_Date, day, week, $("#week_table tr"));
			var week_num = $.datepicker.iso8601Week(cur_Date);
			$("#week_number").text(week_num);
			$("#year_number").text(cur_Date.getFullYear());
			if(week == 0) {
				$("#week_this").show();
			} else {
				$("#week_this").hide();
			}
		};
		
		function next_week() {
			$("#week_target").val("");
			cur_Date.setDate(cur_Date.getDate() + 7); 
			//var myDate = new Date();
			var day = cur_Date.getDay();
			week++;
			if(day == 0) day=7;
			fresh_table(cur_Date, day, week, $("#week_table tr"));

			var week_num = $.datepicker.iso8601Week(cur_Date);
			$("#week_number").text(week_num);
			$("#year_number").text(cur_Date.getFullYear());
			if(week == 0) {
				$("#week_this").show();
			} else {
				$("#week_this").hide();
			}
		};
		
		$("#datepicker_source").datepicker({
			showOtherMonths: true,
			selectOtherMonths: false,
			dateFormat: "yy/mm/dd",
			onSelect: function(dateText,inst){
				$("#day_source").val(dateText);
			}
		});
		$("#datepicker_target").datepicker({
			showOtherMonths: true,
			selectOtherMonths: false,
			dateFormat: "yy/mm/dd",
			onSelect: function(dateText,inst){
				$("#day_target").val(dateText);
			}
		});
		
		$('#clone_source_year').change(function(){ 
			var p1=$(this).children('option:selected').text();//这就是selected的值 
			refresh_select(p1, $("#clone_source_week"));
		});
		
		$('#clone_target_year').change(function(){ 
			var p1=$(this).children('option:selected').text();//这就是selected的值 
			refresh_select(p1, $("#clone_target_week"));
		});
   </script>
   </html>